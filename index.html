<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="City Life Economy Sim - A top-down sandbox simulation with finite resources and live economy chain">
  <meta name="theme-color" content="#0f1e1f">
  <meta property="og:title" content="City Life Economy Sim">
  <meta property="og:description" content="Manage a dynamic city with resource production, trading, and live economy">
  <meta property="og:type" content="website">
  <title>City Life Economy Sim</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üèòÔ∏è</text></svg>">
  <link rel="stylesheet" href="src/css/styles.css">
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <h1>City Life Sim</h1>
      <div class="subtitle">Top-down sandbox with finite resources and a live economy chain.</div>

      <div class="controls">
        <button id="addPersonBtn">Add Person</button>
        <button id="removeSelectedBtn" class="danger">Remove Selected</button>
        <button id="removeRandomBtn" class="danger">Remove Random</button>
        <button id="newSimBtn">New Simulation</button>
        <button id="pauseBtn">Pause</button>
      </div>

      <div class="controls controls-two">
        <button id="saveBtn">Save</button>
        <button id="loadBtn">Load</button>
      </div>

      <div class="controls controls-three">
        <button id="speed1Btn" class="active">x1</button>
        <button id="speed3Btn">x3</button>
        <button id="speed6Btn">x6</button>
      </div>

      <div class="controls">
        <button id="toolsMenuBtn">Tools</button>
      </div>
      <div class="person-card tools-panel hidden" id="toolsPanel">
        <h2>Resource Menu</h2>
        <div class="controls">
          <button id="worldSettingsBtn">World Settings</button>
        </div>
        <div class="controls controls-two">
          <button id="resourceMapBtn" class="active">Map</button>
          <button id="resourceWorldBtn">World</button>
        </div>
        <div class="mini" id="resourceList"></div>
      </div>

      <div class="stat-grid">
        <div class="stat-card">
          <div class="stat-label">Population</div>
          <div class="stat-value" id="popStat">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">City Stage</div>
          <div class="stat-value" id="stageStat" style="font-size: 15px;">Subsistence</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Day</div>
          <div class="stat-value" id="dayStat">1</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Bank Cash</div>
          <div class="stat-value" id="marketCashStat">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">World Money</div>
          <div class="stat-value" id="worldMoneyStat">0</div>
        </div>
      </div>

      <div class="legend">
        <div><b>Person Colors</b></div>
        <div id="professionLegend"></div>
      </div>

      <div class="small-note">
        Core loop: people age, lose health, earn money through production, buy food, and keep the city alive with farming, foraging, and logging.
      </div>
    </aside>

    <main class="world-wrap">
      <canvas id="world"></canvas>
      <div class="overlay" id="overlayText"></div>
    </main>

    <aside class="rightbar">
      <div class="person-card" id="personCard">
        <h2>No person selected</h2>
        <div class="mini">Click any person on the map to inspect stats and needs.</div>
      </div>

      <div class="person-card" id="buildingCard">
        <h2>No object selected</h2>
        <div class="mini">Click any object on the map to inspect description and stats.</div>
      </div>

      <div class="person-card">
        <h2>Market Stocks</h2>
        <table class="table" id="marketTable"></table>
      </div>

      <div class="person-card">
        <h2>Recent Events</h2>
        <div class="event-log" id="eventLog"></div>
      </div>
    </aside>
  </div>

  <div class="modal-backdrop hidden" id="worldSettingsModal">
    <div class="modal-window" role="dialog" aria-modal="true" aria-labelledby="worldSettingsTitle">
      <div class="modal-head">
        <h2 id="worldSettingsTitle">World Settings</h2>
        <button id="worldSettingsCloseBtn" class="danger">Close</button>
      </div>
      <div class="mini">Change core simulation parameters. Settings are stored in save data.</div>

      <div class="settings-section">
        <h3>General</h3>
        <div class="settings-grid">
          <label for="wsAutosaveInput">Autosave interval (sec)</label>
          <input id="wsAutosaveInput" type="number" min="5" max="600" step="1">
          <label for="wsLifeSpanDaysInput">Life span (days)</label>
          <input id="wsLifeSpanDaysInput" type="number" min="20" max="500" step="1">
        </div>
      </div>

      <div class="settings-section">
        <h3>Gameplay & Economy</h3>
        <div class="settings-grid">
          <div class="settings-subtitle">Needs / Behavior</div><div></div>
          <label for="wsNeedHungerBaseInput">Hunger base / hour</label>
          <input id="wsNeedHungerBaseInput" type="number" min="0.05" max="5" step="0.01">
          <label for="wsNeedHungerWorkInput">Hunger work bonus / hour</label>
          <input id="wsNeedHungerWorkInput" type="number" min="0" max="3" step="0.01">
          <label for="wsNeedHungerPenaltyInput">Hunger switch-penalty bonus / hour</label>
          <input id="wsNeedHungerPenaltyInput" type="number" min="0" max="3" step="0.01">
          <label for="wsNeedHealthDecayInput">Health decay base / hour</label>
          <input id="wsNeedHealthDecayInput" type="number" min="0" max="2" step="0.01">
          <label for="wsNeedHealthRegenInput">Health regen when fed / hour</label>
          <input id="wsNeedHealthRegenInput" type="number" min="0" max="1" step="0.01">
          <label for="wsNeedEatTriggerInput">Start eating at hunger</label>
          <input id="wsNeedEatTriggerInput" type="number" min="0" max="100" step="1">
          <label for="wsNeedEatFromInventoryInput">Use carried food at hunger</label>
          <input id="wsNeedEatFromInventoryInput" type="number" min="0" max="100" step="1">
          <label for="wsNeedBuyFoodTriggerInput">Start buying food at hunger</label>
          <input id="wsNeedBuyFoodTriggerInput" type="number" min="0" max="100" step="1">
          <label for="wsNeedEatExecuteInput">Can consume food at hunger</label>
          <input id="wsNeedEatExecuteInput" type="number" min="0" max="100" step="1">
          <label for="wsNeedEatReliefInput">Hunger relief per food</label>
          <input id="wsNeedEatReliefInput" type="number" min="1" max="100" step="1">

          <div class="settings-subtitle">Trade</div><div></div>
          <label for="wsTradeSellRawFactorInput">Sell factor raw goods</label>
          <input id="wsTradeSellRawFactorInput" type="number" min="0.1" max="1.5" step="0.01">
          <label for="wsTradeSellCraftFactorInput">Sell factor crafted goods</label>
          <input id="wsTradeSellCraftFactorInput" type="number" min="0.1" max="1.5" step="0.01">
          <label for="wsTradeExportBatchInput">Log export batch</label>
          <input id="wsTradeExportBatchInput" type="number" min="0" max="50" step="1">
          <label for="wsTradeExportReserveInput">Log export reserve</label>
          <input id="wsTradeExportReserveInput" type="number" min="0" max="100" step="1">

          <div class="settings-subtitle">Demand / Price</div><div></div>
          <label for="wsDemandFoodPerPopInput">Food demand per pop</label>
          <input id="wsDemandFoodPerPopInput" type="number" min="0.2" max="8" step="0.01">
          <label for="wsDemandHungerFactorInput">Food demand hunger factor</label>
          <input id="wsDemandHungerFactorInput" type="number" min="0" max="4" step="0.01">
          <label for="wsDemandLogsPerPopInput">Logs demand per pop</label>
          <input id="wsDemandLogsPerPopInput" type="number" min="0" max="3" step="0.01">
          <label for="wsDemandHerbsPerPopInput">Herbs demand per pop</label>
          <input id="wsDemandHerbsPerPopInput" type="number" min="0" max="3" step="0.01">
          <label for="wsPriceRatioWeightInput">Price weight: demand/supply</label>
          <input id="wsPriceRatioWeightInput" type="number" min="0.1" max="3" step="0.01">
          <label for="wsPriceShortageWeightInput">Price weight: shortage</label>
          <input id="wsPriceShortageWeightInput" type="number" min="0" max="3" step="0.01">
          <label for="wsPriceSmoothingInput">Price smoothing (old weight)</label>
          <input id="wsPriceSmoothingInput" type="number" min="0.05" max="0.95" step="0.01">

          <div class="settings-subtitle">Jobs / Population</div><div></div>
          <label for="wsJobsMaxChangeRatioInput">Max job switches / rebalance</label>
          <input id="wsJobsMaxChangeRatioInput" type="number" min="0.02" max="1" step="0.01">
          <label for="wsBirthBaseChanceInput">Birth base chance / day</label>
          <input id="wsBirthBaseChanceInput" type="number" min="0" max="1" step="0.001">
          <label for="wsBirthPerAdultBonusInput">Birth bonus per adult</label>
          <input id="wsBirthPerAdultBonusInput" type="number" min="0" max="0.2" step="0.001">
          <label for="wsBirthMaxChanceInput">Birth max chance / day</label>
          <input id="wsBirthMaxChanceInput" type="number" min="0" max="1" step="0.001">
          <label for="wsBirthMaxPerDayInput">Max births per day</label>
          <input id="wsBirthMaxPerDayInput" type="number" min="0" max="10" step="1">
        </div>
      </div>

      <div class="settings-section">
        <h3>Roads</h3>
        <div class="settings-grid">
          <label for="wsRoadDecayInput">Road decay / hour</label>
          <input id="wsRoadDecayInput" type="number" min="0.001" max="2" step="0.001">

          <label for="wsRoadStepInput">Road growth / step</label>
          <input id="wsRoadStepInput" type="number" min="0.05" max="5" step="0.01">

          <label for="wsRoadSegmentInput">Road growth / segment</label>
          <input id="wsRoadSegmentInput" type="number" min="0.1" max="8" step="0.01">

          <label for="wsRoadThresholdInput">Road draw threshold</label>
          <input id="wsRoadThresholdInput" type="number" min="0.1" max="10" step="0.01">
        </div>
      </div>

      <div class="settings-section">
        <h3>Resource Regeneration</h3>
        <div class="settings-grid">
          <label for="wsRegenForestInput">Forest wood</label>
          <input id="wsRegenForestInput" type="number" min="0" max="1" step="0.001">

          <label for="wsRegenWildFoodInput">Wild food</label>
          <input id="wsRegenWildFoodInput" type="number" min="0" max="1" step="0.001">

          <label for="wsRegenWildHerbsInput">Wild herbs</label>
          <input id="wsRegenWildHerbsInput" type="number" min="0" max="1" step="0.001">

          <label for="wsRegenOrchardInput">Orchard food</label>
          <input id="wsRegenOrchardInput" type="number" min="0" max="1" step="0.001">

          <label for="wsRegenFarmCropInput">Farm crop</label>
          <input id="wsRegenFarmCropInput" type="number" min="0" max="1" step="0.001">

          <label for="wsRegenFarmFertilityInput">Farm fertility</label>
          <input id="wsRegenFarmFertilityInput" type="number" min="0" max="1" step="0.001">
        </div>
      </div>

      <div class="settings-section">
        <h3>Construction Costs</h3>
        <div class="settings-grid cost-grid">
          <div class="settings-subtitle">Town Hall</div><div></div>
          <label for="wsCostTownhallLogsInput">Logs</label>
          <input id="wsCostTownhallLogsInput" type="number" min="0" max="999" step="1">
          <label for="wsCostTownhallFoodInput">Food</label>
          <input id="wsCostTownhallFoodInput" type="number" min="0" max="999" step="1">
          <label for="wsCostTownhallCashInput">Cash</label>
          <input id="wsCostTownhallCashInput" type="number" min="0" max="99999" step="1">

          <div class="settings-subtitle">Market</div><div></div>
          <label for="wsCostMarketLogsInput">Logs</label>
          <input id="wsCostMarketLogsInput" type="number" min="0" max="999" step="1">
          <label for="wsCostMarketFoodInput">Food</label>
          <input id="wsCostMarketFoodInput" type="number" min="0" max="999" step="1">
          <label for="wsCostMarketCashInput">Cash</label>
          <input id="wsCostMarketCashInput" type="number" min="0" max="99999" step="1">

          <div class="settings-subtitle">Farm</div><div></div>
          <label for="wsCostFarmLogsInput">Logs</label>
          <input id="wsCostFarmLogsInput" type="number" min="0" max="999" step="1">
          <label for="wsCostFarmFoodInput">Food</label>
          <input id="wsCostFarmFoodInput" type="number" min="0" max="999" step="1">
          <label for="wsCostFarmCashInput">Cash</label>
          <input id="wsCostFarmCashInput" type="number" min="0" max="99999" step="1">

          <div class="settings-subtitle">House</div><div></div>
          <label for="wsCostHouseLogsInput">Logs</label>
          <input id="wsCostHouseLogsInput" type="number" min="0" max="999" step="1">
          <label for="wsCostHouseFoodInput">Food</label>
          <input id="wsCostHouseFoodInput" type="number" min="0" max="999" step="1">
          <label for="wsCostHouseCashInput">Cash</label>
          <input id="wsCostHouseCashInput" type="number" min="0" max="99999" step="1">
        </div>
      </div>

      <div class="controls controls-two modal-actions">
        <button id="worldSettingsApplyBtn">Apply</button>
        <button id="worldSettingsApplySaveBtn">Apply + Save</button>
      </div>
    </div>
  </div>

  <script defer src="src/js/config.js"></script>
  <script defer src="src/js/camera.js"></script>
  <script defer src="src/js/storage.js"></script>
  <script defer src="src/js/game.js"></script>
</body>
</html>
